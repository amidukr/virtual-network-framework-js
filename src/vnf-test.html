<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>QUnit Example</title>
    <link rel="stylesheet" href="css/qunit-2.1.1.css">
</head>
<body>
<div id="qunit"></div>
<div id="qunit-fixture"></div>
<script src="lib/qunit-2.1.1.js"></script>
<script data-main="vnf-test.js" src="lib/require.js"></script>

<script type="text/javascript">
    Timeouts = {}
    TestingProfiles = {}

    var TESTING_LEVEL_SMOKE = 0;
    var TESTING_LEVEL_RELEASE = 1;
    var TESTING_LEVEL_DEBUG = 2;
    var TESTING_LEVEL_STRESS = 3;

    TestingProfiles = {
        rate: 1,
        testLevel: TESTING_LEVEL_SMOKE,

        relative__qunitTestTimeout: 3000,
        relative__logCaptureTimeout: 3000,

        relative__reliableFastHeartbeatInterval: 20,
        relative__reliableFastConnectionInvalidateInterval: 200,
        relative__reliableFastConnectionLostTimeout: 600,
        relative__reliableFastHandshakeRetryInterval: 60,
        relative__reliableFastKeepAliveHandshakingChannelTimeout: 240,

        reliableRtcHeartbeatInterval: 1,
        reliableRtcConnectionInvalidateInterval: 10,
        reliableRtcConnectionLostTimeout: 100,
        reliableRtcHandshakeRetryInterval: 10,
        reliableRtcKeepAliveHandshakingChannelTimeout: 100,

        //activeTestingLevel: TESTING_LEVEL_SMOKE,
        activeTestingLevel: TESTING_LEVEL_RELEASE,
        //activeTestingLevel: TESTING_LEVEL_DEBUG,
        //activeTestingLevel: TESTING_LEVEL_STRESS,

        "root:InMemory": {
            rate: 2,
            testLevel: TESTING_LEVEL_SMOKE
        },

        "root:Rtc": {
            rate: 50,
            testLevel: TESTING_LEVEL_DEBUG
        },

        "root:ReliableRtc": {
            rate: 100,

            testLevel: TESTING_LEVEL_RELEASE,

            qunitTestTimeout:  30000,
            logCaptureTimeout: 30000
        },

        "[root:ReliableRtc]-[Reliable Hub v0.2] Connection Lost: by timeout" : {
            qunitTestTimeout:  60000,
            logCaptureTimeout: 60000
        },

        "[root:ReliableRtc]-[Reliable Hub v0.2] Connection Lost: by timeout v2" : {
            rate: 20,
        },

        getValue: function(profileKey, config) {

            if(profileKey == null) {
                return TestingProfiles.getValue([], config);
            }

            if(typeof profileKey == "string") {
                return TestingProfiles.getValue([profileKey], config);
            }


            if(profileKey.constructor !== Array) throw new Error("Unexpected profile type: '" + profileKey + "'");


            for(var i = 0; i < profileKey.length; i++) {

                var profileConfigurations = TestingProfiles[profileKey[i]];

                if(!profileConfigurations) continue;

                var value = profileConfigurations[config];

                if(value != undefined) return value;
            }

            return TestingProfiles[config];
        },

        toAbsoluteInterval: function(profile, timePoints) {
            if(!timePoints) return;

            var rate = TestingProfiles.getValue(profile, "rate");
            return rate * timePoints;
        },

        getInterval: function(profile, config) {
            var absoluteIntervalValue = TestingProfiles.getValue(profile, config);

            if(absoluteIntervalValue) return absoluteIntervalValue;

            var relativeIntervalValue = TestingProfiles.getValue(profile, "relative__" + config);

            return TestingProfiles.toAbsoluteInterval(profile, relativeIntervalValue);
        }
    }

    QUnit.config.testTimeout   = TestingProfiles.getInterval(null, "qunitTestTimeout");
    Timeouts.logCaptureTimeout = TestingProfiles.getInterval(null, "logCaptureTimeout");


    Timeouts.iceSendTimeout = Math.min(Timeouts.logCaptureTimeout/10, 1000);
</script>


</body>
</html>